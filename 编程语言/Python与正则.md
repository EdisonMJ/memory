# Pyhton 使用正则表达式

## 正则语法

字符匹配：

|  模式  |                             描述                             |
| :----: | :----------------------------------------------------------: |
| `[ ]`  | 字符集，如` [abc]` 表示 a 或 b 或 c，`[a-zA-Z0-9]` 表示所有数字和字母 |
| `[^ ]` |                    非字符集，排除包含字符                    |
|  `.`   |                  匹配除换行符以外的任意字符                  |
|  `\w`  |                 匹配字母或数字或下划线或汉字                 |
|  `\W`  |          匹配任意不是字母、数字、下划线、汉字的字符          |
|  `\s`  |           匹配任意的空白符，等价于 `[\f\n\r\t\v]`            |
|  `\S`  |          匹配任何非空白字符，等价于 `[^\f\n\r\t\v]`          |
|  `\d`  |                   匹配数字，等价于 `[0-9]`                   |
|  `\D`  |            匹配任意非数字的字符, 等价于 `[^0-9]`             |

匹配次数：

|  模式   |                     含义                     |
| :-----: | :------------------------------------------: |
|  `{m}`  |             匹配前一个字符 m 次              |
| `{m,n}` |      匹配前一个字符 m 到 n 次（包含 n）      |
|   `*`   |          匹配前面一个字符0到无限次           |
|   `+`   |          匹配前面一个字符1到无限次           |
|   `?`   | 匹配前面一个字符0或1次, 也可以代表非贪婪匹配 |

边界匹配：

| 模式 |                             含义                             |
| :--: | :----------------------------------------------------------: |
| `^`  |        匹配字符串开头。在 M 模式下，会匹配每一行开头         |
| `$`  |        匹配字符串结尾。在 M 模式下，会匹配每一行结尾         |
| `\A` |             仅匹配字符串的开头。即使在 M 模式下              |
| `\Z` |              仅匹配字符串结尾。即使在 M 模式下               |
| `\b` | 匹配一个单词的边界，比如空格等，不过匹配的字符串不会包括分界字符，而 `\s` 会包含空白符 |
| `\B` | 匹配非单词边界。`er\B` 能匹配 verb 中的 er，但不能匹配 never 中的 er |

分组：

| 模式 | 含义 |
| :--: | :--: |
|   `|`   |    左右表达式任意一个   |
| `(...)` | 分组标记，会被赋予一个编号。内部只能使用竖线操作符，分组后可接数量词 |
| `\number` | 引用编号为 `number` 的分组，注意引用的是提取的字符串，而不是正则 |
| `(?P<name>...)` | 给分组命名（也会有个编号） |
| `(?P=<name>)` | 引用名字为 `name` 的分组，注意引用的是提取的字符串，而不是正则 |

其他构造（不作为分组，不消耗字符串内容）：

|      模式       |                             含义                             |
| :-------------: | :----------------------------------------------------------: |                            |
|    `(?:...)`    | 类似 `(...)`，但是不表示一个组（`match()` 和 `findall()` 不会提取） |
|    `(?<=..)`    |     前向界定。代表希望匹配的字符串的前面应该出现的字符串     |
|    `(?=...)`    |     后向界定。代表你希望匹配的字符串后面应该出现的字符串     |
|   `(?<!...)`    |                          前向非界定                          |
|    `(?!...)`    |                          后向非界定                          |

## Re 模块

主要函数：

```python
# 如果一个正则表达式要用很多次，应该先预编译，会生成一个对象，包含下列所有方法
pattern = re.compile(r'xxx')
# 匹配整个字符串，用 `.group()` 提取分组内容
pattern.match(s)
# 找到字符串中所有所有符合内容的子串，返回一个列表
pattern.findall(s)
# 类似于 findall()，但只返回第一个成功匹配的
pattern.search(s)
# 替换字符串中所有匹配的内容，返回替换后的字符串
pattern.sub(func, s)
# 将字符串按匹配内容分割，比 str 自带的 `spilt()` 更灵活
pattern.spilt(s)
```

`re.compile()` 的 flag 参数：

| 标志 |                             含义                             |
| :--: | :----------------------------------------------------------: |
| re.S |              使 `.` 匹配包括换行在内的所有字符               |
| re.I |                     使匹配对大小写不敏感                     |
| re.U | 根据Unicode字符集解析字符，这个标志影响 `\w`，`\W`，`\b`，`\B` |
| re.M |                  多行匹配，影响 `^` 和 `$`                   |

实例，一般加上 r 前缀就不用考虑转义（如反斜杆不用写两个来代表一个）的问题了：

```python
# 匹配整数形式的字符串
re.compile(r'^-?\d+&') 
# 匹配中国境内邮编，6位
re.compile(r'[1-9]\d{5}') 
# 匹配中文字符
re.compile(r'[\u4e00-\u9fa5]*') 
# 匹配国内电话号码
re.compile(r'\d{3}-\d{8}|\d{4}-\d{7}') 
# 精确匹配一个 IP 地址
re.compile(r'(([1‐9]?\d|1\d{2}|2[0‐4]\d|25[0‐5])\.){3}([1‐9]?\d|1\d{2}|2[0‐4]\d|25[0‐5])')
```

